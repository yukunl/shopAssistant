{"ast":null,"code":"var _jsxFileName = \"/Users/a-kun/Desktop/639/dialogflow-beta-2020/src/components/Category.js\";\nimport React from \"react\";\nimport \"../styles/App.css\";\nimport { Link } from \"react-router-dom\";\nimport Card from \"react-bootstrap/Card\";\nimport Image from \"react-bootstrap/Image\";\nimport Spinner from \"react-bootstrap/Spinner\";\nimport Checkbox from '@material-ui/core/Checkbox';\nimport { TiShoppingCart, TiHome } from \"react-icons/ti\";\n\nclass Category extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      products: [],\n      tags: [],\n      applicationTags: []\n    };\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      style: {\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 25\n      },\n      __self: this\n    }, React.createElement(Link, {\n      to: '/' + this.props.username,\n      className: \"button\",\n      style: {\n        margin: 20\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 26\n      },\n      __self: this\n    }, React.createElement(TiHome, {\n      style: styles.homeIcon,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 27\n      },\n      __self: this\n    })), React.createElement(Link, {\n      to: '/' + this.props.username + '/cart',\n      className: \"button\",\n      style: {\n        margin: 20\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 29\n      },\n      __self: this\n    }, React.createElement(TiShoppingCart, {\n      style: styles.shoppingCartIcon,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 30\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      style: styles.pageTitle,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 32\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 33\n      },\n      __self: this\n    }, React.createElement(\"h1\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 34\n      },\n      __self: this\n    }, this.props.name[0].toUpperCase() + this.props.name.substring(1, this.props.name.length)))), React.createElement(\"div\", {\n      style: {\n        display: 'flex',\n        flexDirection: 'row',\n        justifyContent: 'center'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 37\n      },\n      __self: this\n    }, this.getTags()), React.createElement(\"div\", {\n      style: styles.pageBody,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 40\n      },\n      __self: this\n    }, this.getProducts()));\n  }\n\n  async componentDidMount() {\n    await this.clearTags();\n    await this.fetchProducts();\n    this.fetchTags();\n    this.fetchTagsFromServer();\n  }\n\n  async clearTags() {\n    let myHeaders = new Headers();\n    myHeaders.append(\"Content-Type\", \"application/json\");\n    myHeaders.append(\"x-access-token\", localStorage.getItem('token'));\n    let requestOptions = {\n      method: 'DELETE',\n      headers: myHeaders,\n      redirect: 'follow'\n    };\n    await fetch(window.$ENDPOINT_URL + '/application/tags', requestOptions);\n  }\n\n  async fetchTagsFromServer() {\n    while (true) {\n      let myHeaders = new Headers();\n      myHeaders.append(\"Content-Type\", \"application/json\");\n      myHeaders.append(\"x-access-token\", localStorage.getItem('token'));\n      let requestOptions = {\n        method: 'GET',\n        headers: myHeaders,\n        redirect: 'follow'\n      };\n      let tagsResponse = await fetch(window.$ENDPOINT_URL + '/application/tags', requestOptions);\n\n      if (!tagsResponse.ok) {\n        await this.delay(500);\n        continue;\n      }\n\n      let tagsResult = await tagsResponse.json();\n\n      if (tagsResult.tags.length !== this.state.applicationTags.length) {\n        await this.setState({\n          applicationTags: tagsResult.tags\n        });\n        await this.fetchProducts();\n        continue;\n      }\n\n      for (let i = 0; i < this.state.applicationTags.length; i++) {\n        if (tagsResult.tags[i] !== this.state.applicationTags[i]) {\n          await this.setState({\n            applicationTags: tagsResult.tags\n          });\n          await this.fetchProducts();\n          break;\n        }\n      }\n\n      await this.delay(500);\n    }\n  }\n\n  async delay(delayInms) {\n    return new Promise(resolve => {\n      setTimeout(() => {\n        resolve(2);\n      }, delayInms);\n    });\n  }\n\n  getProducts() {\n    let products = [];\n\n    for (const product of this.state.products) {\n      products.push(React.createElement(Link, {\n        key: product.id,\n        to: \"/\" + this.props.username + \"/\" + product.category + \"/products/\" + product.id,\n        className: \"basic\",\n        style: {\n          margin: \"1em\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118\n        },\n        __self: this\n      }, React.createElement(Card, {\n        key: product.name,\n        style: styles.cardBody,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131\n        },\n        __self: this\n      }, React.createElement(Card.Body, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132\n        },\n        __self: this\n      }, React.createElement(Card.Title, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133\n        },\n        __self: this\n      }, React.createElement(\"h2\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134\n        },\n        __self: this\n      }, product.name)), React.createElement(Card.Subtitle, {\n        style: {\n          marginTop: 5\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136\n        },\n        __self: this\n      }, \"$\", product.price), React.createElement(\"div\", {\n        style: {\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139\n        },\n        __self: this\n      }, React.createElement(Image, {\n        style: {\n          width: 150\n        },\n        src: product.image,\n        rounded: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 140\n        },\n        __self: this\n      }))))));\n    }\n\n    return products;\n  }\n\n  async fetchProducts() {\n    let tags = this.state.applicationTags;\n\n    if (tags == null || tags.length === 0) {\n      let myHeaders = new Headers();\n      myHeaders.append(\"Content-Type\", \"application/json\");\n      myHeaders.append(\"x-access-token\", localStorage.getItem(\"token\"));\n      let requestOptions = {\n        method: \"GET\",\n        headers: myHeaders,\n        redirect: \"follow\"\n      };\n      let response = await fetch(window.$ENDPOINT_URL + \"/products?category=\" + this.props.name, requestOptions);\n      let result = await response.json();\n      await this.setState({\n        products: result.products\n      });\n    } else {\n      let myHeaders = new Headers();\n      myHeaders.append(\"Content-Type\", \"application/json\");\n      myHeaders.append(\"x-access-token\", localStorage.getItem(\"token\"));\n      let requestOptions = {\n        method: \"GET\",\n        headers: myHeaders,\n        redirect: \"follow\"\n      };\n      let tagsString = '';\n\n      for (let i = 0; i < tags.length; i++) {\n        if (i === tags.length - 1) {\n          tagsString += tags[i];\n        } else {\n          tagsString += tags[i] + ',';\n        }\n      }\n\n      let response = await fetch(window.$ENDPOINT_URL + '/products?category=' + this.props.name + '&tags=' + tagsString, requestOptions);\n      let result = await response.json();\n      await this.setState({\n        products: result.products\n      });\n    }\n  }\n\n  async fetchTags() {\n    let myHeaders = new Headers();\n    myHeaders.append(\"Content-Type\", \"application/json\");\n    myHeaders.append(\"x-access-token\", localStorage.getItem(\"token\"));\n    let requestOptions = {\n      method: \"GET\",\n      headers: myHeaders,\n      redirect: \"follow\"\n    };\n    let response = await fetch(window.$ENDPOINT_URL + '/categories/' + this.props.name + '/tags', requestOptions);\n    let result = await response.json();\n    this.setState({\n      tags: result.tags\n    });\n  }\n\n  getTags() {\n    if (this.state.tags.length === 0) {\n      return React.createElement(Spinner, {\n        animation: \"border\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221\n        },\n        __self: this\n      });\n    }\n\n    let tags = [];\n    let checked = this.getChecked();\n\n    for (let i = 0; i < this.state.tags.length; i++) {\n      tags.push(React.createElement(\"div\", {\n        key: 'tag_' + i,\n        style: {\n          display: 'flex',\n          flexDirection: 'row',\n          alignItems: 'center',\n          margin: 10\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230\n        },\n        __self: this\n      }, React.createElement(Checkbox, {\n        onChange: e => this.handleCheck(e, this.state.tags[i]),\n        checked: checked[i],\n        color: \"primary\",\n        inputProps: {\n          'aria-label': 'primary checkbox'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 231\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 239\n        },\n        __self: this\n      }, this.state.tags[i])));\n    }\n\n    return tags;\n  }\n\n  getChecked() {\n    let checked = [];\n\n    for (let i = 0; i < this.state.tags.length; i++) {\n      checked.push(this.state.applicationTags.indexOf(this.state.tags[i]) > -1);\n    }\n\n    return checked;\n  }\n\n  async handleCheck(e, tag) {\n    if (e.target.checked) {\n      let myHeaders = new Headers();\n      myHeaders.append(\"Content-Type\", \"application/json\");\n      myHeaders.append(\"x-access-token\", localStorage.getItem(\"token\"));\n      let requestOptions = {\n        method: \"POST\",\n        headers: myHeaders,\n        redirect: \"follow\"\n      };\n      await fetch(window.$ENDPOINT_URL + \"/application/tags/\" + tag, requestOptions);\n    } else {\n      let myHeaders = new Headers();\n      myHeaders.append(\"Content-Type\", \"application/json\");\n      myHeaders.append(\"x-access-token\", localStorage.getItem(\"token\"));\n      let requestOptions = {\n        method: \"DELETE\",\n        headers: myHeaders,\n        redirect: \"follow\"\n      };\n      await fetch(window.$ENDPOINT_URL + \"/application/tags/\" + tag, requestOptions);\n    }\n\n    await this.fetchProducts();\n  }\n\n}\n\nconst styles = {\n  pageTitle: {\n    height: \"20%\",\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    flexDirection: \"row\",\n    fontWeight: \"bold\"\n  },\n  pageBody: {\n    height: \"40%\",\n    width: '70%',\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    flexDirection: \"row\",\n    flexWrap: 'wrap'\n  },\n  cardBody: {\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    flexDirection: \"row\",\n    width: 300\n  },\n  shoppingCartIcon: {\n    height: \"3em\",\n    width: \"3em\",\n    position: \"absolute\",\n    right: 0,\n    top: 0,\n    marginTop: \"0.5em\",\n    marginRight: \"0.5em\"\n  },\n  homeIcon: {\n    height: \"3em\",\n    width: \"3em\",\n    position: \"absolute\",\n    left: 10,\n    top: 0,\n    marginTop: \"0.5em\",\n    marginRight: \"0.5em\"\n  }\n};\nexport default Category;","map":{"version":3,"sources":["/Users/a-kun/Desktop/639/dialogflow-beta-2020/src/components/Category.js"],"names":["React","Link","Card","Image","Spinner","Checkbox","TiShoppingCart","TiHome","Category","Component","constructor","props","state","products","tags","applicationTags","render","display","flexDirection","alignItems","username","margin","styles","homeIcon","shoppingCartIcon","pageTitle","name","toUpperCase","substring","length","justifyContent","getTags","pageBody","getProducts","componentDidMount","clearTags","fetchProducts","fetchTags","fetchTagsFromServer","myHeaders","Headers","append","localStorage","getItem","requestOptions","method","headers","redirect","fetch","window","$ENDPOINT_URL","tagsResponse","ok","delay","tagsResult","json","setState","i","delayInms","Promise","resolve","setTimeout","product","push","id","category","cardBody","marginTop","price","width","image","response","result","tagsString","checked","getChecked","e","handleCheck","indexOf","tag","target","height","fontWeight","flexWrap","position","right","top","marginRight","left"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAO,mBAAP;AACA,SAASC,IAAT,QAAqB,kBAArB;AAEA,OAAOC,IAAP,MAAiB,sBAAjB;AACA,OAAOC,KAAP,MAAkB,uBAAlB;AACA,OAAOC,OAAP,MAAoB,yBAApB;AAEA,OAAOC,QAAP,MAAqB,4BAArB;AAEA,SAASC,cAAT,EAAyBC,MAAzB,QAAuC,gBAAvC;;AAEA,MAAMC,QAAN,SAAuBR,KAAK,CAACS,SAA7B,CAAuC;AACrCC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;AACA,SAAKC,KAAL,GAAa;AACXC,MAAAA,QAAQ,EAAE,EADC;AAEXC,MAAAA,IAAI,EAAE,EAFK;AAGXC,MAAAA,eAAe,EAAE;AAHN,KAAb;AAKD;;AAEDC,EAAAA,MAAM,GAAG;AACP,WACE;AAAK,MAAA,KAAK,EAAE;AAACC,QAAAA,OAAO,EAAE,MAAV;AAAkBC,QAAAA,aAAa,EAAE,QAAjC;AAA2CC,QAAAA,UAAU,EAAE;AAAvD,OAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,oBAAC,IAAD;AAAM,MAAA,EAAE,EAAE,MAAM,KAAKR,KAAL,CAAWS,QAA3B;AAAqC,MAAA,SAAS,EAAC,QAA/C;AAAwD,MAAA,KAAK,EAAE;AAACC,QAAAA,MAAM,EAAE;AAAT,OAA/D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,oBAAC,MAAD;AAAQ,MAAA,KAAK,EAAEC,MAAM,CAACC,QAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CADF,EAIE,oBAAC,IAAD;AAAM,MAAA,EAAE,EAAE,MAAM,KAAKZ,KAAL,CAAWS,QAAjB,GAA4B,OAAtC;AAA+C,MAAA,SAAS,EAAC,QAAzD;AAAkE,MAAA,KAAK,EAAE;AAACC,QAAAA,MAAM,EAAE;AAAT,OAAzE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,oBAAC,cAAD;AAAgB,MAAA,KAAK,EAAEC,MAAM,CAACE,gBAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CAJF,EAOE;AAAK,MAAA,KAAK,EAAEF,MAAM,CAACG,SAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAK,KAAKd,KAAL,CAAWe,IAAX,CAAgB,CAAhB,EAAmBC,WAAnB,KAAmC,KAAKhB,KAAL,CAAWe,IAAX,CAAgBE,SAAhB,CAA0B,CAA1B,EAA6B,KAAKjB,KAAL,CAAWe,IAAX,CAAgBG,MAA7C,CAAxC,CADF,CADF,CAPF,EAYE;AAAK,MAAA,KAAK,EAAE;AAACZ,QAAAA,OAAO,EAAE,MAAV;AAAkBC,QAAAA,aAAa,EAAE,KAAjC;AAAwCY,QAAAA,cAAc,EAAE;AAAxD,OAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACG,KAAKC,OAAL,EADH,CAZF,EAeE;AAAK,MAAA,KAAK,EAAET,MAAM,CAACU,QAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACG,KAAKC,WAAL,EADH,CAfF,CADF;AAqBD;;AAED,QAAMC,iBAAN,GAA0B;AACxB,UAAM,KAAKC,SAAL,EAAN;AACA,UAAM,KAAKC,aAAL,EAAN;AACA,SAAKC,SAAL;AACA,SAAKC,mBAAL;AACD;;AAED,QAAMH,SAAN,GAAkB;AAChB,QAAII,SAAS,GAAG,IAAIC,OAAJ,EAAhB;AACAD,IAAAA,SAAS,CAACE,MAAV,CAAiB,cAAjB,EAAiC,kBAAjC;AACAF,IAAAA,SAAS,CAACE,MAAV,CAAiB,gBAAjB,EAAmCC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAnC;AAEA,QAAIC,cAAc,GAAG;AACnBC,MAAAA,MAAM,EAAE,QADW;AAEnBC,MAAAA,OAAO,EAAEP,SAFU;AAGnBQ,MAAAA,QAAQ,EAAE;AAHS,KAArB;AAMA,UAAMC,KAAK,CAACC,MAAM,CAACC,aAAP,GAAuB,mBAAxB,EAA6CN,cAA7C,CAAX;AACD;;AAED,QAAMN,mBAAN,GAA4B;AAC1B,WAAM,IAAN,EAAY;AACV,UAAIC,SAAS,GAAG,IAAIC,OAAJ,EAAhB;AACAD,MAAAA,SAAS,CAACE,MAAV,CAAiB,cAAjB,EAAiC,kBAAjC;AACAF,MAAAA,SAAS,CAACE,MAAV,CAAiB,gBAAjB,EAAmCC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAnC;AAEA,UAAIC,cAAc,GAAG;AACnBC,QAAAA,MAAM,EAAE,KADW;AAEnBC,QAAAA,OAAO,EAAEP,SAFU;AAGnBQ,QAAAA,QAAQ,EAAE;AAHS,OAArB;AAMA,UAAII,YAAY,GAAG,MAAMH,KAAK,CAACC,MAAM,CAACC,aAAP,GAAuB,mBAAxB,EAA6CN,cAA7C,CAA9B;;AACA,UAAG,CAACO,YAAY,CAACC,EAAjB,EAAqB;AACnB,cAAM,KAAKC,KAAL,CAAW,GAAX,CAAN;AACA;AACD;;AACD,UAAIC,UAAU,GAAG,MAAMH,YAAY,CAACI,IAAb,EAAvB;;AAGA,UAAGD,UAAU,CAACxC,IAAX,CAAgBe,MAAhB,KAA2B,KAAKjB,KAAL,CAAWG,eAAX,CAA2Bc,MAAzD,EAAiE;AAC/D,cAAM,KAAK2B,QAAL,CAAc;AAACzC,UAAAA,eAAe,EAAEuC,UAAU,CAACxC;AAA7B,SAAd,CAAN;AACA,cAAM,KAAKsB,aAAL,EAAN;AACA;AACD;;AAED,WAAI,IAAIqB,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG,KAAK7C,KAAL,CAAWG,eAAX,CAA2Bc,MAA9C,EAAsD4B,CAAC,EAAvD,EAA2D;AACzD,YAAGH,UAAU,CAACxC,IAAX,CAAgB2C,CAAhB,MAAuB,KAAK7C,KAAL,CAAWG,eAAX,CAA2B0C,CAA3B,CAA1B,EAAyD;AACvD,gBAAM,KAAKD,QAAL,CAAc;AAACzC,YAAAA,eAAe,EAAEuC,UAAU,CAACxC;AAA7B,WAAd,CAAN;AACA,gBAAM,KAAKsB,aAAL,EAAN;AACA;AACD;AACF;;AACD,YAAM,KAAKiB,KAAL,CAAW,GAAX,CAAN;AACD;AACF;;AAED,QAAMA,KAAN,CAAYK,SAAZ,EAAuB;AACrB,WAAO,IAAIC,OAAJ,CAAYC,OAAO,IAAK;AAC7BC,MAAAA,UAAU,CAAC,MAAM;AACfD,QAAAA,OAAO,CAAC,CAAD,CAAP;AACD,OAFS,EAEPF,SAFO,CAAV;AAGD,KAJM,CAAP;AAKD;;AAEDzB,EAAAA,WAAW,GAAG;AACZ,QAAIpB,QAAQ,GAAG,EAAf;;AAEA,SAAI,MAAMiD,OAAV,IAAqB,KAAKlD,KAAL,CAAWC,QAAhC,EAA0C;AACxCA,MAAAA,QAAQ,CAACkD,IAAT,CACE,oBAAC,IAAD;AACE,QAAA,GAAG,EAAED,OAAO,CAACE,EADf;AAEE,QAAA,EAAE,EACA,MACA,KAAKrD,KAAL,CAAWS,QADX,GAEA,GAFA,GAGA0C,OAAO,CAACG,QAHR,GAIA,YAJA,GAKAH,OAAO,CAACE,EARZ;AAUE,QAAA,SAAS,EAAC,OAVZ;AAWE,QAAA,KAAK,EAAE;AAAE3C,UAAAA,MAAM,EAAE;AAAV,SAXT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAaE,oBAAC,IAAD;AAAM,QAAA,GAAG,EAAEyC,OAAO,CAACpC,IAAnB;AAAyB,QAAA,KAAK,EAAEJ,MAAM,CAAC4C,QAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,IAAD,CAAM,IAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,IAAD,CAAM,KAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKJ,OAAO,CAACpC,IAAb,CADF,CADF,EAIE,oBAAC,IAAD,CAAM,QAAN;AAAe,QAAA,KAAK,EAAE;AAAEyC,UAAAA,SAAS,EAAE;AAAb,SAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cACIL,OAAO,CAACM,KADZ,CAJF,EAOE;AAAK,QAAA,KAAK,EAAE;AAACnD,UAAAA,OAAO,EAAE,MAAV;AAAkBE,UAAAA,UAAU,EAAE,QAA9B;AAAwCW,UAAAA,cAAc,EAAE;AAAxD,SAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,KAAD;AAAO,QAAA,KAAK,EAAE;AAAEuC,UAAAA,KAAK,EAAE;AAAT,SAAd;AAA8B,QAAA,GAAG,EAAEP,OAAO,CAACQ,KAA3C;AAAkD,QAAA,OAAO,MAAzD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CAPF,CADF,CAbF,CADF;AA6BD;;AAED,WAAOzD,QAAP;AACD;;AAED,QAAMuB,aAAN,GAAsB;AACpB,QAAItB,IAAI,GAAG,KAAKF,KAAL,CAAWG,eAAtB;;AACA,QAAGD,IAAI,IAAI,IAAR,IAAgBA,IAAI,CAACe,MAAL,KAAgB,CAAnC,EAAsC;AACpC,UAAIU,SAAS,GAAG,IAAIC,OAAJ,EAAhB;AACAD,MAAAA,SAAS,CAACE,MAAV,CAAiB,cAAjB,EAAiC,kBAAjC;AACAF,MAAAA,SAAS,CAACE,MAAV,CAAiB,gBAAjB,EAAmCC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAnC;AAEA,UAAIC,cAAc,GAAG;AACnBC,QAAAA,MAAM,EAAE,KADW;AAEnBC,QAAAA,OAAO,EAAEP,SAFU;AAGnBQ,QAAAA,QAAQ,EAAE;AAHS,OAArB;AAMA,UAAIwB,QAAQ,GAAG,MAAMvB,KAAK,CACxBC,MAAM,CAACC,aAAP,GAAuB,qBAAvB,GAA+C,KAAKvC,KAAL,CAAWe,IADlC,EAExBkB,cAFwB,CAA1B;AAIA,UAAI4B,MAAM,GAAG,MAAMD,QAAQ,CAAChB,IAAT,EAAnB;AAEA,YAAM,KAAKC,QAAL,CAAc;AAAE3C,QAAAA,QAAQ,EAAE2D,MAAM,CAAC3D;AAAnB,OAAd,CAAN;AACD,KAlBD,MAmBK;AACH,UAAI0B,SAAS,GAAG,IAAIC,OAAJ,EAAhB;AACAD,MAAAA,SAAS,CAACE,MAAV,CAAiB,cAAjB,EAAiC,kBAAjC;AACAF,MAAAA,SAAS,CAACE,MAAV,CAAiB,gBAAjB,EAAmCC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAnC;AAEA,UAAIC,cAAc,GAAG;AACnBC,QAAAA,MAAM,EAAE,KADW;AAEnBC,QAAAA,OAAO,EAAEP,SAFU;AAGnBQ,QAAAA,QAAQ,EAAE;AAHS,OAArB;AAMA,UAAI0B,UAAU,GAAG,EAAjB;;AAEA,WAAI,IAAIhB,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG3C,IAAI,CAACe,MAAxB,EAAgC4B,CAAC,EAAjC,EAAqC;AACnC,YAAGA,CAAC,KAAK3C,IAAI,CAACe,MAAL,GAAc,CAAvB,EAA0B;AACxB4C,UAAAA,UAAU,IAAI3D,IAAI,CAAC2C,CAAD,CAAlB;AACD,SAFD,MAGK;AACHgB,UAAAA,UAAU,IAAI3D,IAAI,CAAC2C,CAAD,CAAJ,GAAU,GAAxB;AACD;AACF;;AAED,UAAIc,QAAQ,GAAG,MAAMvB,KAAK,CAACC,MAAM,CAACC,aAAP,GAAuB,qBAAvB,GAA+C,KAAKvC,KAAL,CAAWe,IAA1D,GAAiE,QAAjE,GAA4E+C,UAA7E,EAAyF7B,cAAzF,CAA1B;AACA,UAAI4B,MAAM,GAAG,MAAMD,QAAQ,CAAChB,IAAT,EAAnB;AAEA,YAAM,KAAKC,QAAL,CAAc;AAAE3C,QAAAA,QAAQ,EAAE2D,MAAM,CAAC3D;AAAnB,OAAd,CAAN;AACD;AACF;;AAED,QAAMwB,SAAN,GAAkB;AAChB,QAAIE,SAAS,GAAG,IAAIC,OAAJ,EAAhB;AACAD,IAAAA,SAAS,CAACE,MAAV,CAAiB,cAAjB,EAAiC,kBAAjC;AACAF,IAAAA,SAAS,CAACE,MAAV,CAAiB,gBAAjB,EAAmCC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAnC;AAEA,QAAIC,cAAc,GAAG;AACnBC,MAAAA,MAAM,EAAE,KADW;AAEnBC,MAAAA,OAAO,EAAEP,SAFU;AAGnBQ,MAAAA,QAAQ,EAAE;AAHS,KAArB;AAMA,QAAIwB,QAAQ,GAAG,MAAMvB,KAAK,CAACC,MAAM,CAACC,aAAP,GAAuB,cAAvB,GAAwC,KAAKvC,KAAL,CAAWe,IAAnD,GAA0D,OAA3D,EAAoEkB,cAApE,CAA1B;AACA,QAAI4B,MAAM,GAAG,MAAMD,QAAQ,CAAChB,IAAT,EAAnB;AAEA,SAAKC,QAAL,CAAc;AAAC1C,MAAAA,IAAI,EAAE0D,MAAM,CAAC1D;AAAd,KAAd;AACD;;AAEDiB,EAAAA,OAAO,GAAG;AACR,QAAG,KAAKnB,KAAL,CAAWE,IAAX,CAAgBe,MAAhB,KAA2B,CAA9B,EAAiC;AAC/B,aACE,oBAAC,OAAD;AAAS,QAAA,SAAS,EAAC,QAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF;AAGD;;AAED,QAAIf,IAAI,GAAG,EAAX;AACA,QAAI4D,OAAO,GAAG,KAAKC,UAAL,EAAd;;AAEA,SAAI,IAAIlB,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG,KAAK7C,KAAL,CAAWE,IAAX,CAAgBe,MAAnC,EAA2C4B,CAAC,EAA5C,EAAgD;AAC9C3C,MAAAA,IAAI,CAACiD,IAAL,CACE;AAAK,QAAA,GAAG,EAAE,SAASN,CAAnB;AAAsB,QAAA,KAAK,EAAE;AAACxC,UAAAA,OAAO,EAAE,MAAV;AAAkBC,UAAAA,aAAa,EAAE,KAAjC;AAAwCC,UAAAA,UAAU,EAAE,QAApD;AAA8DE,UAAAA,MAAM,EAAE;AAAtE,SAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,QAAD;AACE,QAAA,QAAQ,EAAGuD,CAAD,IAAO,KAAKC,WAAL,CAAiBD,CAAjB,EAAoB,KAAKhE,KAAL,CAAWE,IAAX,CAAgB2C,CAAhB,CAApB,CADnB;AAEE,QAAA,OAAO,EAAEiB,OAAO,CAACjB,CAAD,CAFlB;AAGE,QAAA,KAAK,EAAC,SAHR;AAIE,QAAA,UAAU,EAAE;AACV,wBAAc;AADJ,SAJd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,EASE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAM,KAAK7C,KAAL,CAAWE,IAAX,CAAgB2C,CAAhB,CAAN,CATF,CADF;AAaD;;AAED,WAAO3C,IAAP;AACD;;AAED6D,EAAAA,UAAU,GAAG;AACX,QAAID,OAAO,GAAG,EAAd;;AACA,SAAI,IAAIjB,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG,KAAK7C,KAAL,CAAWE,IAAX,CAAgBe,MAAnC,EAA2C4B,CAAC,EAA5C,EAAgD;AAC9CiB,MAAAA,OAAO,CAACX,IAAR,CAAa,KAAKnD,KAAL,CAAWG,eAAX,CAA2B+D,OAA3B,CAAmC,KAAKlE,KAAL,CAAWE,IAAX,CAAgB2C,CAAhB,CAAnC,IAAyD,CAAC,CAAvE;AACD;;AAED,WAAOiB,OAAP;AACD;;AAED,QAAMG,WAAN,CAAkBD,CAAlB,EAAqBG,GAArB,EAA0B;AACxB,QAAGH,CAAC,CAACI,MAAF,CAASN,OAAZ,EAAqB;AACnB,UAAInC,SAAS,GAAG,IAAIC,OAAJ,EAAhB;AACAD,MAAAA,SAAS,CAACE,MAAV,CAAiB,cAAjB,EAAiC,kBAAjC;AACAF,MAAAA,SAAS,CAACE,MAAV,CAAiB,gBAAjB,EAAmCC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAnC;AAEA,UAAIC,cAAc,GAAG;AACnBC,QAAAA,MAAM,EAAE,MADW;AAEnBC,QAAAA,OAAO,EAAEP,SAFU;AAGnBQ,QAAAA,QAAQ,EAAE;AAHS,OAArB;AAMA,YAAMC,KAAK,CAACC,MAAM,CAACC,aAAP,GAAuB,oBAAvB,GAA8C6B,GAA/C,EAAoDnC,cAApD,CAAX;AACD,KAZD,MAaK;AACH,UAAIL,SAAS,GAAG,IAAIC,OAAJ,EAAhB;AACAD,MAAAA,SAAS,CAACE,MAAV,CAAiB,cAAjB,EAAiC,kBAAjC;AACAF,MAAAA,SAAS,CAACE,MAAV,CAAiB,gBAAjB,EAAmCC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAnC;AAEA,UAAIC,cAAc,GAAG;AACnBC,QAAAA,MAAM,EAAE,QADW;AAEnBC,QAAAA,OAAO,EAAEP,SAFU;AAGnBQ,QAAAA,QAAQ,EAAE;AAHS,OAArB;AAMA,YAAMC,KAAK,CAACC,MAAM,CAACC,aAAP,GAAuB,oBAAvB,GAA8C6B,GAA/C,EAAoDnC,cAApD,CAAX;AACD;;AAED,UAAM,KAAKR,aAAL,EAAN;AACD;;AAhRoC;;AAmRvC,MAAMd,MAAM,GAAG;AACbG,EAAAA,SAAS,EAAE;AACTwD,IAAAA,MAAM,EAAE,KADC;AAEThE,IAAAA,OAAO,EAAE,MAFA;AAGTa,IAAAA,cAAc,EAAE,QAHP;AAITX,IAAAA,UAAU,EAAE,QAJH;AAKTD,IAAAA,aAAa,EAAE,KALN;AAMTgE,IAAAA,UAAU,EAAE;AANH,GADE;AASblD,EAAAA,QAAQ,EAAE;AACRiD,IAAAA,MAAM,EAAE,KADA;AAERZ,IAAAA,KAAK,EAAE,KAFC;AAGRpD,IAAAA,OAAO,EAAE,MAHD;AAIRa,IAAAA,cAAc,EAAE,QAJR;AAKRX,IAAAA,UAAU,EAAE,QALJ;AAMRD,IAAAA,aAAa,EAAE,KANP;AAORiE,IAAAA,QAAQ,EAAE;AAPF,GATG;AAkBbjB,EAAAA,QAAQ,EAAE;AACRjD,IAAAA,OAAO,EAAE,MADD;AAERa,IAAAA,cAAc,EAAE,QAFR;AAGRX,IAAAA,UAAU,EAAE,QAHJ;AAIRD,IAAAA,aAAa,EAAE,KAJP;AAKRmD,IAAAA,KAAK,EAAE;AALC,GAlBG;AAyBb7C,EAAAA,gBAAgB,EAAE;AAChByD,IAAAA,MAAM,EAAE,KADQ;AAEhBZ,IAAAA,KAAK,EAAE,KAFS;AAGhBe,IAAAA,QAAQ,EAAE,UAHM;AAIhBC,IAAAA,KAAK,EAAE,CAJS;AAKhBC,IAAAA,GAAG,EAAE,CALW;AAMhBnB,IAAAA,SAAS,EAAE,OANK;AAOhBoB,IAAAA,WAAW,EAAE;AAPG,GAzBL;AAkCbhE,EAAAA,QAAQ,EAAE;AACR0D,IAAAA,MAAM,EAAE,KADA;AAERZ,IAAAA,KAAK,EAAE,KAFC;AAGRe,IAAAA,QAAQ,EAAE,UAHF;AAIRI,IAAAA,IAAI,EAAE,EAJE;AAKRF,IAAAA,GAAG,EAAE,CALG;AAMRnB,IAAAA,SAAS,EAAE,OANH;AAORoB,IAAAA,WAAW,EAAE;AAPL;AAlCG,CAAf;AA6CA,eAAe/E,QAAf","sourcesContent":["import React from \"react\";\r\nimport \"../styles/App.css\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nimport Card from \"react-bootstrap/Card\";\r\nimport Image from \"react-bootstrap/Image\";\r\nimport Spinner from \"react-bootstrap/Spinner\";\r\n\r\nimport Checkbox from '@material-ui/core/Checkbox';\r\n\r\nimport { TiShoppingCart, TiHome } from \"react-icons/ti\";\r\n\r\nclass Category extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      products: [],\r\n      tags: [],\r\n      applicationTags: []\r\n    };\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div style={{display: 'flex', flexDirection: 'column', alignItems: 'center'}}>\r\n        <Link to={'/' + this.props.username} className='button' style={{margin: 20}}>\r\n          <TiHome style={styles.homeIcon} />\r\n        </Link>\r\n        <Link to={'/' + this.props.username + '/cart'} className='button' style={{margin: 20}}>\r\n          <TiShoppingCart style={styles.shoppingCartIcon} />\r\n        </Link>\r\n        <div style={styles.pageTitle}>\r\n          <span>\r\n            <h1>{this.props.name[0].toUpperCase() + this.props.name.substring(1, this.props.name.length)}</h1>\r\n          </span>\r\n        </div>\r\n        <div style={{display: 'flex', flexDirection: 'row', justifyContent: 'center'}}>\r\n          {this.getTags()}\r\n        </div>\r\n        <div style={styles.pageBody}>\r\n          {this.getProducts()}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  async componentDidMount() {\r\n    await this.clearTags();\r\n    await this.fetchProducts();\r\n    this.fetchTags();\r\n    this.fetchTagsFromServer();\r\n  }\r\n\r\n  async clearTags() {\r\n    let myHeaders = new Headers();\r\n    myHeaders.append(\"Content-Type\", \"application/json\");\r\n    myHeaders.append(\"x-access-token\", localStorage.getItem('token'));\r\n\r\n    let requestOptions = {\r\n      method: 'DELETE',\r\n      headers: myHeaders,\r\n      redirect: 'follow'\r\n    };\r\n\r\n    await fetch(window.$ENDPOINT_URL + '/application/tags', requestOptions);\r\n  }\r\n\r\n  async fetchTagsFromServer() {\r\n    while(true) {\r\n      let myHeaders = new Headers();\r\n      myHeaders.append(\"Content-Type\", \"application/json\");\r\n      myHeaders.append(\"x-access-token\", localStorage.getItem('token'));\r\n\r\n      let requestOptions = {\r\n        method: 'GET',\r\n        headers: myHeaders,\r\n        redirect: 'follow'\r\n      };\r\n\r\n      let tagsResponse = await fetch(window.$ENDPOINT_URL + '/application/tags', requestOptions);\r\n      if(!tagsResponse.ok) {\r\n        await this.delay(500);\r\n        continue;\r\n      }\r\n      let tagsResult = await tagsResponse.json();\r\n\r\n\r\n      if(tagsResult.tags.length !== this.state.applicationTags.length) {\r\n        await this.setState({applicationTags: tagsResult.tags});\r\n        await this.fetchProducts();\r\n        continue;\r\n      }\r\n\r\n      for(let i = 0; i < this.state.applicationTags.length; i++) {\r\n        if(tagsResult.tags[i] !== this.state.applicationTags[i]) {\r\n          await this.setState({applicationTags: tagsResult.tags});\r\n          await this.fetchProducts();\r\n          break;\r\n        }\r\n      }\r\n      await this.delay(500);\r\n    }\r\n  }\r\n\r\n  async delay(delayInms) {\r\n    return new Promise(resolve  => {\r\n      setTimeout(() => {\r\n        resolve(2);\r\n      }, delayInms);\r\n    });\r\n  }\r\n\r\n  getProducts() {\r\n    let products = [];\r\n\r\n    for(const product of this.state.products) {\r\n      products.push(\r\n        <Link\r\n          key={product.id}\r\n          to={\r\n            \"/\" +\r\n            this.props.username +\r\n            \"/\" +\r\n            product.category +\r\n            \"/products/\" +\r\n            product.id\r\n          }\r\n          className=\"basic\"\r\n          style={{ margin: \"1em\" }}\r\n        >\r\n          <Card key={product.name} style={styles.cardBody}>\r\n            <Card.Body>\r\n              <Card.Title>\r\n                <h2>{product.name}</h2>\r\n              </Card.Title>\r\n              <Card.Subtitle style={{ marginTop: 5 }}>\r\n                ${product.price}\r\n              </Card.Subtitle>\r\n              <div style={{display: 'flex', alignItems: 'center', justifyContent: 'center'}}>\r\n                <Image style={{ width: 150 }} src={product.image} rounded />\r\n              </div>\r\n            </Card.Body>\r\n          </Card>\r\n        </Link>\r\n      );\r\n    }\r\n\r\n    return products;\r\n  }\r\n\r\n  async fetchProducts() {\r\n    let tags = this.state.applicationTags;\r\n    if(tags == null || tags.length === 0) {\r\n      let myHeaders = new Headers();\r\n      myHeaders.append(\"Content-Type\", \"application/json\");\r\n      myHeaders.append(\"x-access-token\", localStorage.getItem(\"token\"));\r\n\r\n      let requestOptions = {\r\n        method: \"GET\",\r\n        headers: myHeaders,\r\n        redirect: \"follow\"\r\n      };\r\n\r\n      let response = await fetch(\r\n        window.$ENDPOINT_URL + \"/products?category=\" + this.props.name,\r\n        requestOptions\r\n      );\r\n      let result = await response.json();\r\n\r\n      await this.setState({ products: result.products });\r\n    }\r\n    else {\r\n      let myHeaders = new Headers();\r\n      myHeaders.append(\"Content-Type\", \"application/json\");\r\n      myHeaders.append(\"x-access-token\", localStorage.getItem(\"token\"));\r\n\r\n      let requestOptions = {\r\n        method: \"GET\",\r\n        headers: myHeaders,\r\n        redirect: \"follow\"\r\n      };\r\n\r\n      let tagsString = '';\r\n\r\n      for(let i = 0; i < tags.length; i++) {\r\n        if(i === tags.length - 1) {\r\n          tagsString += tags[i];\r\n        }\r\n        else {\r\n          tagsString += tags[i] + ',';\r\n        }\r\n      }\r\n\r\n      let response = await fetch(window.$ENDPOINT_URL + '/products?category=' + this.props.name + '&tags=' + tagsString, requestOptions);\r\n      let result = await response.json();\r\n\r\n      await this.setState({ products: result.products });\r\n    }\r\n  }\r\n\r\n  async fetchTags() {\r\n    let myHeaders = new Headers();\r\n    myHeaders.append(\"Content-Type\", \"application/json\");\r\n    myHeaders.append(\"x-access-token\", localStorage.getItem(\"token\"));\r\n\r\n    let requestOptions = {\r\n      method: \"GET\",\r\n      headers: myHeaders,\r\n      redirect: \"follow\"\r\n    };\r\n\r\n    let response = await fetch(window.$ENDPOINT_URL + '/categories/' + this.props.name + '/tags', requestOptions);\r\n    let result = await response.json();\r\n\r\n    this.setState({tags: result.tags})\r\n  }\r\n\r\n  getTags() {\r\n    if(this.state.tags.length === 0) {\r\n      return (\r\n        <Spinner animation=\"border\" />\r\n      )\r\n    }\r\n\r\n    let tags = [];\r\n    let checked = this.getChecked();\r\n\r\n    for(let i = 0; i < this.state.tags.length; i++) {\r\n      tags.push (\r\n        <div key={'tag_' + i} style={{display: 'flex', flexDirection: 'row', alignItems: 'center', margin: 10}}>\r\n          <Checkbox\r\n            onChange={(e) => this.handleCheck(e, this.state.tags[i])}\r\n            checked={checked[i]}\r\n            color='primary'\r\n            inputProps={{\r\n              'aria-label': 'primary checkbox',\r\n            }}\r\n          />\r\n          <div>{this.state.tags[i]}</div>\r\n        </div>\r\n      )\r\n    }\r\n\r\n    return tags;\r\n  }\r\n\r\n  getChecked() {\r\n    let checked = [];\r\n    for(let i = 0; i < this.state.tags.length; i++) {\r\n      checked.push(this.state.applicationTags.indexOf(this.state.tags[i]) > -1)\r\n    }\r\n\r\n    return checked\r\n  }\r\n\r\n  async handleCheck(e, tag) {\r\n    if(e.target.checked) {\r\n      let myHeaders = new Headers();\r\n      myHeaders.append(\"Content-Type\", \"application/json\");\r\n      myHeaders.append(\"x-access-token\", localStorage.getItem(\"token\"));\r\n\r\n      let requestOptions = {\r\n        method: \"POST\",\r\n        headers: myHeaders,\r\n        redirect: \"follow\"\r\n      };\r\n\r\n      await fetch(window.$ENDPOINT_URL + \"/application/tags/\" + tag, requestOptions);\r\n    }\r\n    else {\r\n      let myHeaders = new Headers();\r\n      myHeaders.append(\"Content-Type\", \"application/json\");\r\n      myHeaders.append(\"x-access-token\", localStorage.getItem(\"token\"));\r\n\r\n      let requestOptions = {\r\n        method: \"DELETE\",\r\n        headers: myHeaders,\r\n        redirect: \"follow\"\r\n      };\r\n\r\n      await fetch(window.$ENDPOINT_URL + \"/application/tags/\" + tag, requestOptions);\r\n    }\r\n\r\n    await this.fetchProducts();\r\n  }\r\n}\r\n\r\nconst styles = {\r\n  pageTitle: {\r\n    height: \"20%\",\r\n    display: \"flex\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    flexDirection: \"row\",\r\n    fontWeight: \"bold\"\r\n  },\r\n  pageBody: {\r\n    height: \"40%\",\r\n    width: '70%',\r\n    display: \"flex\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    flexDirection: \"row\",\r\n    flexWrap: 'wrap'\r\n  },\r\n  cardBody: {\r\n    display: \"flex\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n    flexDirection: \"row\",\r\n    width: 300\r\n  },\r\n  shoppingCartIcon: {\r\n    height: \"3em\",\r\n    width: \"3em\",\r\n    position: \"absolute\",\r\n    right: 0,\r\n    top: 0,\r\n    marginTop: \"0.5em\",\r\n    marginRight: \"0.5em\"\r\n  },\r\n  homeIcon: {\r\n    height: \"3em\",\r\n    width: \"3em\",\r\n    position: \"absolute\",\r\n    left: 10,\r\n    top: 0,\r\n    marginTop: \"0.5em\",\r\n    marginRight: \"0.5em\"\r\n  }\r\n};\r\n\r\nexport default Category;\r\n"]},"metadata":{},"sourceType":"module"}